# Rate Limiter

Rate limiter written in Kotlin with the Vert.x framework. Uses Redis Lua script for rate limiting.

### [Read the blog post](https://lukaszzagroba.com/rate-limiter-experiments)

## Table of Contents

- [Installation](#installation)
- [Usage](#usage)
- [Motivation](#motivation)
- [Testing](#testing)
- [Acknowledgements & Links](#acknowledgements--links)
- [License](#license)

## Installation

1. Prerequisites:
   - Java 21
   - Git (to clone the repository)
   - Docker (for running via Docker Compose)

2. Clone the Repository:
   git clone https://github.com/lzag/rate-limiter.git
   cd rate-limiter

3. Adjust the config:
   Configuration can be set in conf/conf.yaml

4. Start the app with Docker:
    ```
    docker-compose up -d
    ````

## Usage

This project implements a rate limiter using different algorithms. The algorithms are located in checkers.lua. One algo needs a regular refill to be run by the app (token bucket).

#### Development

1. Run the Application Locally:
   ./gradlew run

2. Test the Endpoint:
   Send HTTP requests to `http://localhost:8888/`, for example using httpie:
   ```
   http :8888 X-User-Id:1`
   ```

## Motivation

The main motivation is to learn the rate limit concept and how to implement it in Kotlin with the Vert.x framework.

Here are some of the concepts I learned while writing this program:
- Lua Scripting: Used Redis Lua scripts to implement atomic operations for the token bucket algorithm.
- Building Reliable Infrastructure and Circuit Breakers: Explored how rate limiting can act as a circuit breaker to prevent overload.
- Asynchronous Programming with Vert.x: Leveraged Vert.xâ€™s event-driven model for handling HTTP requests efficiently.
- Testing with JUnit 5 and Vert.x: Implemented both unit and integration tests, including parameterized tests.

## Testing

The project includes some basic tests tests (in `src/test/kotlin`) using JUnit 5 and Vert.x testing utilities as well as Lua algos tests src/test/lua.

Run all tests (starts Redis in Docker automatically and runs Lua test as well)
```
./gradlew test
```

Key tests include:
- Rate Limiting Test: Verifies that 5 concurrent requests succeed (200) and the 6th fails (503).
- Parameterized Tests: Checks rate limiting behavior with varying numbers of requests.

## Acknowledgements & Links

- [Token Bucket Algorithm](https://en.wikipedia.org/wiki/Token_bucket#Algorithm)
- [An Alternative Approach to Rate Limiting](https://www.figma.com/blog/an-alternative-approach-to-rate-limiting/)
- [Vert.x Documentation](https://vertx.io/docs/)
- [JUnit 5 Parameterized Tests](https://junit.org/junit5/docs/current/user-guide/#writing-tests-parameterized-tests)

## Author

- [Lukasz Zagroba](https://lukaszzagroba.com)
